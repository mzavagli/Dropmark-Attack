import matplotlib.pyplot as plt

EXIT_LOG_PATH = "../shadow.data/hosts/exit1/tor.1000.stdout"
RELAY1_LOG_PATH = "../shadow.data/hosts/relay1/tor.1000.stdout"
RELAY2_LOG_PATH = "../shadow.data/hosts/relay2/tor.1000.stdout"

OUTPUT_PATH = "logs/times.txt"

content = ""
y = []
x = []

old_y = ['04:19.550', '04:20.550', '04:21.550', '05:01.550', '15:03.550', '15:03.850', '15:04.202', '15:04.550', '15:06.550', '15:07.550', '15:08.550', '25:00.350', '25:00.750', '25:00.850', '25:00.951', '25:01.052', '25:01.054', '25:01.105', '25:01.154', '25:01.156', '25:01.204', '25:01.206', '25:01.256', '25:01.258', '25:01.352', '25:01.354', '25:01.355', '25:01.406', '25:01.408', '25:01.454', '25:01.456', '25:01.458', '25:01.460', '25:01.504', '25:01.506', '25:01.508', '25:01.510', '25:01.550', '25:01.560', '25:01.562', '25:01.564', '25:01.654', '25:01.656', '25:01.658', '25:01.712', '25:01.714', '25:01.758', '25:01.760', '25:01.762', '25:01.764', '25:01.766', '25:01.800', '25:01.806', '25:01.808', '25:01.810', '25:01.812', '25:01.814', '25:01.815', '25:01.850', '25:01.862', '25:01.864', '25:01.866', '25:01.868', '25:01.870', '25:01.956', '25:01.958', '25:01.960', '25:01.962']
old_x = [1, 1, 1, 1, 4, 3, 2, 1, 1, 1, 1, 1, 4, 12, 24, 32, 14, 56, 32, 6, 32, 37, 32, 31, 30, 20, 12, 23, 40, 20, 32, 42, 31, 28, 64, 33, 62, 1, 32, 67, 26, 7, 32, 85, 63, 63, 11, 32, 65, 68, 73, 1, 26, 64, 64, 32, 160, 27, 1, 2, 32, 72, 129, 15, 18, 32, 32, 55]

with open(RELAY2_LOG_PATH) as infile:
    logs = infile.readlines()

for line in logs:
    if "FLAG" in line:
        t = line.split(" ")[2][3:]
        if t not in y:
            y.append(t)
            x.append(1)
        else:
            x[y.index(t)] += 1
        content += t
        content += '\n'

print(y)
print(x)

with open(OUTPUT_PATH, "w") as outfile:
    outfile.write(content)

plt.figure(figsize=(250, 50))
plt.bar(y, x, label="with injection")
plt.bar(old_y, old_x, label="without injection")
plt.legend()
plt.show()